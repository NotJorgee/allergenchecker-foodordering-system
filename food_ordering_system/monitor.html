<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Monitor</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; }
        body { background-color: #121212; color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- HEADER --- */
        .monitor-header {
            height: 80px; background-color: #1e1e1e; display: flex; align-items: center; justify-content: center;
            font-size: 2.5rem; font-weight: 800; letter-spacing: 2px; border-bottom: 2px solid #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5); z-index: 10;
        }
        .monitor-header span { color: #ffc107; margin-right: 10px; }

        /* --- MAIN SPLIT --- */
        .monitor-container { display: flex; flex: 1; height: calc(100vh - 80px); }

        /* --- LEFT SIDE (PREPARING) --- */
        .panel-preparing {
            width: 50%; background-color: #2c2c2c; border-right: 1px solid #444;
            display: flex; flex-direction: column;
        }
        
        /* --- RIGHT SIDE (READY) --- */
        .panel-ready {
            width: 50%; background-color: #1b5e20; /* Dark Green */
            display: flex; flex-direction: column;
        }

        /* --- PANEL HEADERS --- */
        .p-header {
            padding: 20px; font-size: 2rem; font-weight: 700; text-transform: uppercase; text-align: center;
            background: rgba(0,0,0,0.2);
        }
        .p-header.prep { color: #ffca28; }
        .p-header.ready { color: #fff; background-color: #2e7d32; }

        /* --- NUMBER GRIDS --- */
        .number-grid {
            flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 20px; justify-content: center;
        }

        /* --- ORDER CARD --- */
        .order-ticket {
            background: rgba(255,255,255,0.1); padding: 15px 30px; border-radius: 12px;
            font-size: 3.5rem; font-weight: 800; letter-spacing: 2px;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid transparent;
        }
        .order-ticket.ready-ticket {
            background: white; color: #1b5e20; font-size: 5rem; /* Bigger for Ready */
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: flashGreen 2s infinite;
        }

        /* --- ANIMATIONS --- */
        @keyframes popIn { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes flashGreen { 0%, 100% { border-color: transparent; } 50% { border-color: #ffd700; } }

        /* --- NO ORDERS STATE --- */
        .empty-msg { width: 100%; text-align: center; color: rgba(255,255,255,0.3); font-size: 1.5rem; margin-top: 50px; }

    </style>
</head>
<body>

    <div class="monitor-header">
        <span>üçî</span> NOW SERVING
    </div>

    <div class="monitor-container">
        
        <div class="panel-preparing">
            <div class="p-header prep">üïí Preparing</div>
            <div class="number-grid" id="list-preparing">
                </div>
        </div>

        <div class="panel-ready">
            <div class="p-header ready">‚úÖ Ready for Pickup</div>
            <div class="number-grid" id="list-ready">
                </div>
        </div>

    </div>

    <audio id="bellSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <script>
        let previousReadyOrders = []; // To track changes for the sound effect

        function updateMonitor() {
            fetch('get_queue.php')
                .then(res => res.json())
                .then(orders => {
                    const prepContainer = document.getElementById('list-preparing');
                    const readyContainer = document.getElementById('list-ready');
                    
                    // Clear current lists (simple way)
                    // Note: For a smoother production app, you'd diff the DOM, 
                    // but clearing/redrawing is fine for 2-second polling.
                    prepContainer.innerHTML = '';
                    readyContainer.innerHTML = '';

                    const currentReadyIds = [];

                    orders.forEach(order => {
                        const el = document.createElement('div');
                        
                        if (order.status === 'preparing') {
                            el.className = 'order-ticket';
                            el.innerText = order.id;
                            prepContainer.appendChild(el);
                        } 
                        else if (order.status === 'ready') {
                            el.className = 'order-ticket ready-ticket';
                            el.innerText = order.id;
                            readyContainer.appendChild(el);
                            currentReadyIds.push(order.id);
                        }
                    });

                    // Check if we need to play sound (New order moved to READY)
                    if (hasNewReadyOrder(previousReadyOrders, currentReadyIds)) {
                        playSound();
                    }

                    // Update state
                    previousReadyOrders = currentReadyIds;
                })
                .catch(err => console.error("Monitor Error:", err));
        }

        function hasNewReadyOrder(oldList, newList) {
            // If newList has an ID that wasn't in oldList, return true
            // Also ignore the very first load (oldList empty) to avoid noise blast on refresh
            if (oldList.length === 0 && newList.length > 0) return false; 
            
            return newList.some(id => !oldList.includes(id));
        }

        function playSound() {
            const audio = document.getElementById('bellSound');
            audio.play().catch(e => console.log("Audio blocked until user interaction"));
        }

        // Poll every 3 seconds
        setInterval(updateMonitor, 3000);
        updateMonitor(); // Initial run

        // Autoplay policy workaround: User needs to click once to enable audio
        document.body.addEventListener('click', () => {
            document.getElementById('bellSound').play();
            document.getElementById('bellSound').pause();
        });

    </script>
</body>
</html>